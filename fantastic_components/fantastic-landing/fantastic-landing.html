<!-- Polymer core -->
<link rel="import" href="/bower_components/polymer/polymer.html">

<!--Polymer elements -->
<link rel="import" href="/bower_components/core-menu/core-menu.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">

<!-- Firebase elements-->
<link rel="import" href="/bower_components/firebase-element/firebase-element.html">
<link rel="import" href="/bower_components/firebase-element/firebase-login.html">

<!-- PVC Globals element -->
<link rel="import" href="/bower_components/pvc-globals/pvc-globals.html">

<polymer-element name="fantastic-landing">
  <template>
    <paper-menu-button halign="left">
      <paper-button on-click="{{login}}" id="login" hidden?="{{!statusKnown || user}}">login with google</paper-button>
      <paper-button on-click="{{logout}}" hidden?="{{!statusKnown || !user}}">logout</paper-button>
    </paper-menu-button>

    <firebase-element id="base" on-data-change="{{dataChange}}" data="{{data}}" location="https://fantastic.firebaseio.com/user" log></firebase-element>
    <firebase-login id="baseLogin" user="{{user}}" statusKnown="{{statusKnown}}" location="https://fantastic.firebaseio.com/user" provider="google" on-login="{{onLogin}}" on-error="{{onLoginError}}"></firebase-login>
    <pvc-globals values="{{ globals }}"></pvc-globals>

  </template>
  <script>
  (function() {
    'use strict';
    Polymer('fantastic-landing',{

      ready : function(){

      },

      dataChange: function() {
      
      },

      login: function() {
        this.$.baseLogin.login();
      },

      logout: function() {
        this.$.baseLogin.logout();
      },

      onLogin: function() {
        this.globals.currentUser = this.user;
        if (this.user){
          var ref = new Firebase(this.$.base.location);
          var myUid = this.user.uid;
          var myName = this.user.google.displayName;

          ref.child(myUid).set({
            uid: myUid,
            username: myName
          });
        }
      },

      onLoginError: function(err) {
        console.log('An error occurred.');
      }

    });
  })();
  </script>
</polymer-element>
